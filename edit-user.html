<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Editar Usuario - CliniStock</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="panel-container" id="edit-container">
        <p>Cargando datos del usuario...</p>
    </div>

    <script>
        const API_URL = 'https://clinistock-final.onrender.com';
        const params = new URLSearchParams(window.location.search);
        const usuarioId = params.get('id');

        window.onload = async function() {
            const container = document.getElementById('edit-container');
            if (!usuarioId) {
                container.innerHTML = '<h1>Error</h1><p>No se especificó un ID de usuario.</p>';
                return;
            }

            try {
                const response = await fetch(${API_URL}/usuario/${usuarioId});
                const user = await response.json();
                if (!response.ok) throw new Error(user.error || 'Error desconocido');

                container.innerHTML = `
                    <header>
                        <h1>Editar Usuario</h1>
                        <a href="users.html" class="header-link">Cancelar y Volver</a>
                    </header>
                    <form id="editUserForm">
                        <div class="input-group">
                            <label for="nombre_usuario">Nombre de Usuario</label>
                            <input type="text" id="nombre_usuario" value="${user.nombre_usuario}" required>
                        </div>
                        <div class="input-group">
                            <label for="nombre_completo">Nombre Completo</label>
                            <input type="text" id="nombre_completo" value="${user.nombre_completo}" required>
                        </div>
                        <div class="input-group">
                            <label for="contrasena">Nueva Contraseña (dejar en blanco para no cambiar)</label>
                            <input type="password" id="contrasena">
                        </div>
                        <button type="submit" class="submit-button">Guardar Cambios</button>
                    </form>
                `;

                document.getElementById('editUserForm').addEventListener('submit', handleUpdate);

            } catch (error) {
                container.innerHTML = <h1>Error al cargar</h1><p>${error.message}</p>;
            }
        };
        
        async function handleUpdate(event) {
            event.preventDefault();
            const updatedData = {
                nombre_usuario: document.getElementById('nombre_usuario').value,
                nombre_completo: document.getElementById('nombre_completo').value,
                contrasena: document.getElementById('contrasena').value,
            };

            try {
                const response = await fetch(${API_URL}/usuario/actualizar/${usuarioId}, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(updatedData)
                });
                const result = await response.json();
                if (!response.ok) throw new Error(result.message || 'Error al actualizar');
                
                alert('¡Usuario actualizado con éxito!');
                window.location.href = 'users.html';
            } catch (error) {
                alert(Error al guardar los cambios: ${error.message});
            }
        }
    </script>
</body>
</html>
