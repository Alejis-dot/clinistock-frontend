<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Solicitar Insumos - CliniStock</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="panel-container">
        <header>
            <h1>Consultar y Solicitar Insumos</h1>
            <a href="my-requests.html" class="header-link">Ver Mis Solicitudes</a>
        </header>
        
        <form id="search-form" class="search-form">
            <input type="text" id="search-term" name="search_term" class="search-input" placeholder="Buscar por código o nombre...">
            <button type="submit" class="search-button">Buscar</button>
        </form>

        <table class="solicitudes-tabla">
            <thead>
                <tr>
                    <th>Código</th> 
                    <th>Insumo</th>
                    <th>Realizar Solicitud</th>
                </tr>
            </thead>
            <tbody id="results-body">
                <tr>
                    <td colspan="3" style="text-align:center;">Ingresa un término de búsqueda para ver los insumos.</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div id="solicitarModal" class="modal" style="display: none;">
        </div>

    <script>
        const API_URL = 'https://clinistock-final.onrender.com';
        // ... (el resto del script se queda igual hasta la parte que construye la tabla)

        // Dentro del EventListener del searchForm:
        searchForm.addEventListener('submit', async function(event) {
            // ... (código de búsqueda se queda igual)
            try {
                // ...
                const results = await response.json();
                resultsBody.innerHTML = ''; 

                if (results.length === 0) {
                    resultsBody.innerHTML = '<tr><td colspan="3" style="text-align:center;">No se encontraron resultados.</td></tr>';
                } else {
                    results.forEach(item => {
                        const tr = document.createElement('tr');
                        // --- CONSTRUCCIÓN DE LA TABLA MEJORADA ---
                        tr.innerHTML = `
                            <td>${item.codigo_interno}</td>
                            <td>${item.descripcion}</td>
                            <td>
                                <button class="action-button" onclick="openModal(${item.id}, '${item.descripcion.replace(/'/g, "\\'")}')">Solicitar</button>
                            </td>
                        `;
                        resultsBody.appendChild(tr);
                    });
                }
            } catch (error) {
                // ...
            }
        });
        // ... (el resto del script se queda igual)
    </script>
</body>
</html>
