const API_URL = 'https://clinistock-final.onrender.com';
        const newUserModal = document.getElementById('newUserModal');
        const newUserForm = document.getElementById('newUserForm');

        function openNewUserModal() { newUserModal.style.display = 'block'; }
        function closeNewUserModal() { newUserModal.style.display = 'none'; }

        async function cargarUsuarios() {
            const tbody = document.getElementById('users-body');
            tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">Cargando usuarios...</td></tr>';
            try {
                const response = await fetch(API_URL + '/usuarios');
                const usuarios = await response.json();
                tbody.innerHTML = '';
                if (usuarios.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">No hay usuarios de tipo "Solicitante".</td></tr>';
                } else {
                    usuarios.forEach(user => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${user.nombre_usuario}</td>
                            <td>${user.nombre_completo}</td>
                            <td>${user.rol}</td>
                            <td>
                                <a href="edit-user.html?id=${user.id}" class="action-button-edit">Editar</a>
                            </td>
                        `;
                        tbody.appendChild(tr);
                    });
                }
            } catch (error) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; color: red;">Error al cargar usuarios.</td></tr>';
            }
        }

        newUserForm.addEventListener('submit', async function(event) {
            event.preventDefault();
            const nuevoUsuario = {
                nombre_usuario: document.getElementById('nombre_usuario_modal').value,
                contrasena: document.getElementById('contrasena_modal').value,
                nombre_completo: document.getElementById('nombre_completo_modal').value,
                rol: document.getElementById('rol_modal').value
            };
            try {
                const response = await fetch(API_URL + '/usuarios/crear', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(nuevoUsuario)
                });
                const result = await response.json();
                if (response.ok && result.success) {
                    alert('¡Usuario creado con éxito!');
                    closeNewUserModal();
                    cargarUsuarios();
                } else {
                    throw new Error(result.message || 'Error desconocido');
                }
            } catch (error) {
                alert(Error al crear el usuario: ${error.message});
            }
        });

        window.onload = cargarUsuarios;
        window.onclick = function(event) {
            if (event.target == newUserModal) {
                closeNewUserModal();
            }
        }
