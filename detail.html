<!DOCTYPE html>
<html lang="es"><head><meta charset="UTF-8"><title>Detalle de Solicitud - CliniStock</title><link rel="stylesheet" href="style.css"></head><body><div class="panel-container" id="detail-container"><p>Cargando detalles de la solicitud...</p></div><script>const API_URL='https://clinistock-final.onrender.com',params=new URLSearchParams(window.location.search),solicitudId=params.get('id');async function handleUpdate(e){e.preventDefault();const t={estado:document.getElementById('estado').value,orden_compra:document.getElementById('orden_compra').value,proveedor:document.getElementById('proveedor').value,notas_internas:document.getElementById('notas_internas').value};try{const e=await fetch(`${API_URL}/solicitud/actualizar/${solicitudId}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(t)}),o=await e.json();if(!e.ok)throw new Error(o.message||'Error al actualizar');alert('¡Solicitud actualizada con éxito!'),document.getElementById('estado-actual').textContent=t.estado}catch(e){console.error('Error:',e),alert(`Error al guardar los cambios: ${e.message}`)}}window.onload=async function(){const e=document.getElementById('detail-container');if(!solicitudId)return void(e.innerHTML='<h1>Error</h1><p>No se especificó un ID de solicitud.</p>');try{const t=await fetch(`${API_URL}/solicitud/${solicitudId}`),o=await t.json();if(!t.ok)throw new Error(o.error||'Error desconocido');e.innerHTML=`\n <header>\n <h1>Detalle de la Solicitud #${o.id}</h1>\n <a href="dashboard.html" class="header-link">Volver al Panel</a>\n </header>\n <div class="detail-grid">\n <div class="detail-item"><strong>Insumo:</strong><p>${o.insumo_descripcion}</p></div>\n <div class="detail-item"><strong>Cantidad Solicitada:</strong><p>${o.cantidad_solicitada}</p></div>\n <div class="detail-item"><strong>Urgencia:</strong><p>${o.tipo_urgencia}</p></div>\n <div class="detail-item"><strong>Solicitado por:</strong><p>${o.usuario_nombre}</p></div>\n <div class="detail-item"><strong>Fecha de Solicitud:</strong><p>${new Date(o.fecha_solicitud).toLocaleString()}</p></div>\n <div class="detail-item"><strong>Estado Actual:</strong><p id="estado-actual">${o.estado}</p></div>\n </div>\n <hr>\n <div class="management-section">\n <h2>Gestionar Solicitud</h2>\n <form id="management-form">\n <div class="form-grid">\n <div class="input-group">\n <label for="orden_compra">Orden de Compra</label>\n <input type="text" id="orden_compra" name="orden_compra" value="${o.orden_compra||''}">\n </div>\n <div class="input-group">\n <label for="proveedor">Proveedor</label>\n <input type="text" id="proveedor" name="proveedor" value="${o.proveedor||''}">\n </div>\n <div class="input-group full-width">\n <label for="notas_internas">Notas Internas</label>\n <textarea id="notas_internas" name="notas_internas">${o.notas_internas||''}</textarea>\n </div>\n <div class="input-group">\n <label for="estado">Cambiar Estado</label>\n <select id="estado" name="estado">\n <option value="Solicitado" ${'Solicitado'===o.estado?'selected':''}>Solicitado</option>\n <option value="Comprado" ${'Comprado'===o.estado?'selected':''}>Comprado</option>\n <option value="Enviado" ${'Enviado'===o.estado?'selected':''}>Enviado</option>\n <option value="Recibido" ${'Recibido'===o.estado?'selected':''}>Recibido</option>\n <option value="Agotado" ${'Agotado'===o.estado?'selected':''}>Agotado</option>\n </select>\n </div>\n </div>\n <button type="submit" class="submit-button">Guardar Cambios</button>\n </form>\n </div>\n `,document.getElementById('management-form').addEventListener('submit',handleUpdate)}catch(t){console.error('Error:',t),e.innerHTML=`<h1>Error al cargar</h1><p>${t.message}</p>`}};</script></body></html>
